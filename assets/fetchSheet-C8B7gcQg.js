import{P as l}from"./papaparse.min-DIlZzThM.js";import"./index-ChyDDEDG.js";function f(n){if(!n)return"";const t=new Date(n);if(Number.isNaN(t.getTime()))return n;const e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${s}`}function m(n){for(let t=0;t<n.length;t++){const e=n[t].map(r=>(r||"").toString().trim().toLowerCase());if(e.includes("date placed")||e.includes("ticker")&&e.includes("p&l"))return t}return-1}function h(n,t){const e={};for(const o in t)e[o]=n[t[o]]!==void 0?n[t[o]]:"";const r=(e.PnL||e["P&L"])!==""?Number(e.PnL||e["P&L"]):void 0,s=e["Max risk"]?Number(e["Max risk"]):e["Max Risk"]?Number(e["Max Risk"]):void 0,d=[];(r===void 0||Number.isNaN(r))&&d.push("Missing PnL"),(s===void 0||s===0||Number.isNaN(s))&&d.push("Missing Max risk");const a=d.length===0?r/s*100:void 0;return{date:f(e["Exit Date"]||e["exit date"]||e.date||""),dateOpened:f(e["Date placed"]||e["date placed"]||""),symbol:e.Ticker||e.ticker||"",quantity:e.contracts?Number(e.contracts):void 0,pnl:r,maxRisk:s,strategy:e["strategy type"]||e.Strategy||e.strategy||"",side:e.Side||e.side||"",roi:a,issues:d,raw:e}}async function k(n,t=0){const e=`https://docs.google.com/spreadsheets/d/${n}/export?format=csv&gid=${t}`,r=await fetch(e);if(!r.ok)throw new Error("Failed to fetch sheet");const s=await r.text(),a=l.parse(s,{skipEmptyLines:!0,dynamicTyping:!1}).data;if(!a||!a.length)throw new Error("Empty sheet");const o=m(a);if(o===-1)throw new Error("Could not find header row in sheet (expected: Date placed, Ticker, P&L, etc.)");const c=a[o].map(i=>(i||"").toString().trim()),u={};return c.forEach((i,p)=>u[i]=p),console.log("Sheet header row detected at index:",o),console.log("Headers found:",c),console.log("First data row raw:",a[o+1]),a.slice(o+1).map(i=>h(i,u)).filter(i=>i.symbol||i.date)}export{k as fetchSheetAsJson};
